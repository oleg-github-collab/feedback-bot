defmodule FeedbackBot.Jobs.DailyReminderJob do
  @moduledoc """
  Ğ©Ğ¾Ğ´Ğ½Ñ Ğ¾ 15:00 Ğ·Ğ°Ğ¿Ğ¸Ñ‚ÑƒÑ” Ñ‡Ğ¸ Ñ” feedback Ğ¿Ñ€Ğ¾ ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ±Ñ–Ñ‚Ğ½Ğ¸ĞºÑ–Ğ²
  Ğ Ñ–Ğ·Ğ½Ñ– Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ¸ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ Ğ´Ğ»Ñ ÑƒĞ½Ğ¸ĞºĞ½ĞµĞ½Ğ½Ñ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ñ–
  """
  use Oban.Worker, queue: :notifications, max_attempts: 3

  require Logger
  alias FeedbackBot.Feedbacks

  @impl Oban.Worker
  def perform(%Oban.Job{args: %{"user_id" => user_id}}) do
    Logger.info("Sending daily reminder to user #{user_id}...")

    # ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ”Ğ¼Ğ¾ Ñ‡Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒĞ²Ğ°Ğ² ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ feedback ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–
    today_start = DateTime.new!(Date.utc_today(), ~T[00:00:00])
    today_feedbacks =
      Feedbacks.filter_feedbacks(%{from: today_start})
      |> Enum.filter(&(&1.telegram_user_id == user_id))

    message = get_random_reminder_message(length(today_feedbacks))

    case ExGram.send_message(user_id, message, parse_mode: "Markdown") do
      {:ok, _} ->
        Logger.info("Daily reminder sent to user #{user_id}")
        {:ok, %{sent_to: user_id}}

      {:error, error} ->
        Logger.error("Failed to send reminder to user #{user_id}: #{inspect(error)}")
        {:error, error}
    end
  end

  # Overload Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ²ÑÑ–Ğ¼ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼
  def perform(%Oban.Job{args: %{}}) do
    Logger.info("Sending daily reminders to all users...")

    user_ids = get_active_user_ids()

    Enum.each(user_ids, fn user_id ->
      %{user_id: user_id}
      |> __MODULE__.new()
      |> Oban.insert()
    end)

    {:ok, %{users: length(user_ids)}}
  end

  defp get_random_reminder_message(0) do
    # ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ñ‰Ğµ Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒĞ²Ğ°Ğ² ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–
    messages = [
      """
      ğŸ‘‹ *ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚!*

      Ğ¯Ğº Ğ¿Ñ€Ğ¾Ğ¹ÑˆĞ¾Ğ² Ñ€Ğ¾Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ? ğŸ¤”

      Ğ¯ĞºÑ‰Ğ¾ Ñ” Ñ‰Ğ¾ ÑĞºĞ°Ğ·Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñƒ ĞºĞ¾Ğ»ĞµĞ³ â€” Ñ Ğ²ĞµÑÑŒ ÑƒĞ²Ğ°Ğ¶Ğ½Ğ¸Ğ¹! ğŸ‘‚
      ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ´Ñ–ÑˆĞ»Ñ–Ñ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ ğŸ¤

      _Ğ’Ğ°Ñˆ Ñ„Ñ–Ğ´Ğ±ĞµĞº Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ°Ğ³Ğ°Ñ” Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ!_ âœ¨
      """,
      """
      ğŸŒ¤ *Ğ”Ğ¾Ğ±Ñ€Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ!*

      Ğ§Ğ°Ñ Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğ³Ğ¾ check-in ğŸ“‹

      Ğ„ Ğ²Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾ ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ±Ñ–Ñ‚Ğ½Ğ¸ĞºÑ–Ğ² ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–?
      ĞŸĞ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ñ– Ñ‡Ğ¸ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ– â€” Ğ²ÑĞµ Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğ¾!

      ğŸ¤ Ğ“Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ½Ğ° 30-60 ÑĞµĞºÑƒĞ½Ğ´ Ğ±ÑƒĞ´Ğµ Ñ–Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¸Ğ¼!
      """,
      """
      â˜•ï¸ *Ğ§Ğ°Ñ Ğ´Ğ»Ñ feedback!*

      Ğ Ğ¾Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² ÑĞ°Ğ¼Ğ¾Ğ¼Ñƒ Ñ€Ğ¾Ğ·Ğ¿Ğ°Ğ»Ñ–... Ğ„ Ñ‰Ğ¾ ÑĞºĞ°Ğ·Ğ°Ñ‚Ğ¸? ğŸ’¬

      ĞœĞ¾Ğ¶Ğµ Ñ…Ñ‚Ğ¾ÑÑŒ ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ– Ğ¾ÑĞ¾Ğ±Ğ»Ğ¸Ğ²Ğ¾ Ğ´Ğ¾Ğ±Ñ€Ğµ Ğ¿Ğ¾Ğ¿Ñ€Ğ°Ñ†ÑĞ²Ğ°Ğ²? ğŸŒŸ
      ĞĞ±Ğ¾ Ğ½Ğ°Ğ²Ğ¿Ğ°ĞºĞ¸, Ñ” Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ½Ñ– Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ¸? âš ï¸

      _ĞĞ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ ğŸ¤ Ñ– Ğ¿Ğ¾Ğ´Ñ–Ğ»Ñ–Ñ‚ÑŒÑÑ Ğ´ÑƒĞ¼ĞºĞ°Ğ¼Ğ¸!_
      """,
      """
      ğŸ¯ *Ğ¨Ğ²Ğ¸Ğ´ĞºĞµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ:*

      Ğ¯Ğº ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ– Ğ¿Ñ€Ğ°Ñ†ÑÑ” Ğ²Ğ°ÑˆĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°?

      Ğ¥Ñ‚Ğ¾ÑÑŒ Ğ²Ğ¸Ğ´Ñ–Ğ»ÑÑ”Ñ‚ÑŒÑÑ (Ğ² Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾Ğ¼Ñƒ Ñ‡Ğ¸ Ğ¿Ğ¾Ğ³Ğ°Ğ½Ğ¾Ğ¼Ñƒ ÑĞµĞ½ÑÑ–)?
      Ğ„ ÑĞºÑ–ÑÑŒ Ñ–Ğ½Ñ†Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸ Ñ‡Ğ¸ ÑƒÑĞ¿Ñ–Ñ…Ğ¸?

      ğŸ“¢ ĞŸĞ¾Ğ´Ñ–Ğ»Ñ–Ñ‚ÑŒÑÑ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¸Ğ¼! Ğ¦Ğµ Ğ·Ğ°Ğ¹Ğ¼Ğµ Ğ»Ğ¸ÑˆĞµ Ñ…Ğ²Ğ¸Ğ»Ğ¸Ğ½Ñƒ.
      """,
      """
      ğŸ’¼ *Feedback Time!*

      Ğ•Ğ¹, Ñ” Ñ‰Ğ¾ Ñ€Ğ¾Ğ·ĞºĞ°Ğ·Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾ ĞºĞ¾Ğ»ĞµĞ³? ğŸ—£

      ĞĞµ Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğ¾ Ñ‡Ğ¸ Ñ†Ğµ Ğ²ĞµĞ»Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ‡Ğ¸ Ğ´Ñ€Ñ–Ğ±Ğ½Ğ¸Ñ†Ñ â€”
      Ğ²ÑĞµ Ğ¹Ğ´Ğµ Ğ² Ğ°Ğ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºÑƒ Ñ– Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ°Ğ³Ğ°Ñ” Ğ±Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ!

      ğŸ¤ _ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ Ğ¼Ñ–ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½ Ñ– Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ–Ñ‚ÑŒ!_
      """,
      """
      ğŸ”” *Ğ©Ğ¾Ğ´ĞµĞ½Ğ½Ğµ Ğ½Ğ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ*

      ĞĞµ Ğ·Ğ°Ğ±ÑƒĞ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¾ Ñ„Ñ–Ğ´Ğ±ĞµĞº! ğŸ˜Š

      Ğ¡ÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ– Ñ‰Ğµ Ğ½Ğµ Ğ±ÑƒĞ»Ğ¾ Ğ¶Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒ Ğ²Ñ–Ğ´ Ğ²Ğ°Ñ.
      ĞœĞ¾Ğ¶Ğµ Ñ” Ğ²Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸?

      _Ğ“Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ = ÑˆĞ²Ğ¸Ğ´ĞºĞ¾ + Ğ·Ñ€ÑƒÑ‡Ğ½Ğ¾_ ğŸ¤âœ¨
      """,
      """
      â° *3pm Check-in*

      ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚! Ğ¯Ğº ÑĞ¿Ñ€Ğ°Ğ²Ğ¸ Ğ½Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ–? ğŸ‘‹

      Ğ¯ĞºÑ‰Ğ¾ Ğ¼Ğ°Ñ”Ñ‚Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´ â€” Ğ¿Ğ¾Ğ´Ñ–Ğ»Ñ–Ñ‚ÑŒÑÑ Ñ„Ñ–Ğ´Ğ±ĞµĞºĞ¾Ğ¼!

      â€¢ Ğ¥Ñ‚Ğ¾ÑÑŒ Ğ´Ğ¾Ğ±Ñ€Ğµ Ğ¿Ğ¾Ğ¿Ñ€Ğ°Ñ†ÑĞ²Ğ°Ğ²? ğŸŒŸ
      â€¢ Ğ„ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¸? âš ï¸
      â€¢ ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ? ğŸ’­

      ğŸ¤ Ğ¯ ÑĞ»ÑƒÑ…Ğ°Ñ!
      """,
      """
      ğŸ¤ *Ğ§Ğ°Ñ Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ğ³Ğ¾Ğ»Ğ¾ÑÑƒ!*

      Ğ”ĞµĞ½ÑŒ Ğ¼Ğ°Ğ¹Ğ¶Ğµ Ğ·Ğ°ĞºÑ–Ğ½Ñ‡ÑƒÑ”Ñ‚ÑŒÑÑ... Ğ„ Ñ‰Ğ¾ ÑĞºĞ°Ğ·Ğ°Ñ‚Ğ¸?

      Ğ’Ğ°Ñˆ Ñ‰Ğ¾Ğ´ĞµĞ½Ğ½Ğ¸Ğ¹ Ñ„Ñ–Ğ´Ğ±ĞµĞº Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ°Ğ³Ğ°Ñ”:
      âœ“ Ğ‘Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñƒ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ
      âœ“ ĞŸĞ¾Ğ¼Ñ–Ñ‡Ğ°Ñ‚Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ğ¸
      âœ“ ĞŸĞ¾ĞºÑ€Ğ°Ñ‰ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ

      _ĞŸĞ¾Ğ´Ñ–Ğ»Ñ–Ñ‚ÑŒÑÑ Ğ´ÑƒĞ¼ĞºĞ°Ğ¼Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ·Ğ°Ñ€Ğ°Ğ·!_ ğŸ’¬
      """
    ]

    Enum.random(messages)
  end

  defp get_random_reminder_message(_count) do
    # ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ²Ğ¶Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒĞ²Ğ°Ğ² ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–
    messages = [
      """
      ğŸ‘ *Ğ”ÑĞºÑƒÑ Ğ·Ğ° ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ Ñ„Ñ–Ğ´Ğ±ĞµĞº!*

      ĞœĞ¾Ğ¶Ğµ Ñ” Ñ‰Ğµ Ñ‰Ğ¾ÑÑŒ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸? ğŸ¤”

      Ğ¯ĞºÑ‰Ğ¾ Ğ¿Ñ€Ğ¾Ñ‚ÑĞ³Ğ¾Ğ¼ Ğ´Ğ½Ñ Ğ²Ñ–Ğ´Ğ±ÑƒĞ»Ğ¾ÑÑŒ Ñ‰Ğ¾ÑÑŒ Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğµ â€”
      Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸ Ñ‰Ğµ Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ñ–Ğ´Ğ³ÑƒĞº!

      _Ğ§Ğ¸Ğ¼ Ğ±Ñ–Ğ»ÑŒÑˆĞµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ â€” Ñ‚Ğ¸Ğ¼ ĞºÑ€Ğ°Ñ‰Ğ° Ğ°Ğ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ°_ ğŸ“Šâœ¨
      """,
      """
      âœ… *Ğ’Ğ°Ñˆ Ñ„Ñ–Ğ´Ğ±ĞµĞº ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ– Ğ²Ğ¶Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾!*

      ĞĞ»Ğµ ÑĞºÑ‰Ğ¾ Ñ” Ñ‰Ğµ Ğ´ÑƒĞ¼ĞºĞ¸ â€” Ñ Ğ·Ğ°Ğ²Ğ¶Ğ´Ğ¸ Ñ‚ÑƒÑ‚! ğŸ˜Š

      ğŸ¤ ĞœĞ¾Ğ¶Ğ½Ğ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ°Ğ²Ğ³Ğ¾Ğ´Ğ½Ğ¾ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑ–Ğ²
      _ĞšĞ¾Ğ¶ĞµĞ½ Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğ¸Ğ¹!_
      """,
      """
      ğŸ™ *Ğ”ÑĞºÑƒÑ Ñ‰Ğ¾ Ğ¿Ğ¾Ğ´Ñ–Ğ»Ğ¸Ğ»Ğ¸ÑÑŒ!*

      Ğ¡ÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–ÑˆĞ½Ñ–Ğ¹ Ñ„Ñ–Ğ´Ğ±ĞµĞº Ğ²Ğ¶Ğµ Ğ² Ğ±Ğ°Ğ·Ñ– âœ“

      Ğ¯ĞºÑ‰Ğ¾ Ñ‰Ğ¾ÑÑŒ Ñ‰Ğµ Ñ‚Ñ€Ğ°Ğ¿Ğ»ÑĞ»Ğ¾ÑÑŒ â€” Ğ½Ğµ ÑĞ¾Ñ€Ğ¾Ğ¼Ñ‚ĞµÑÑŒ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸! ğŸ’¬
      """,
      """
      ğŸ˜Š *Ğ§ÑƒĞ´Ğ¾Ğ²Ğ¾!*

      Ğ’Ğ¸ Ğ²Ğ¶Ğµ Ğ·Ğ°Ğ»Ğ¸ÑˆĞ¸Ğ»Ğ¸ Ñ„Ñ–Ğ´Ğ±ĞµĞº ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ– ğŸ“

      Ğ„ Ñ‰Ğµ Ñ‰Ğ¾ÑÑŒ? Ğ”Ğ²ĞµÑ€Ñ– Ğ·Ğ°Ğ²Ğ¶Ğ´Ğ¸ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ñ–! ğŸšª
      ğŸ¤ _Ğ©Ğµ Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ñ–Ğ´Ğ³ÑƒĞº = Ğ±Ñ–Ğ»ÑŒÑˆĞµ Ñ–Ğ½ÑĞ°Ğ¹Ñ‚Ñ–Ğ²_
      """
    ]

    Enum.random(messages)
  end

  defp get_active_user_ids do
    # ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ğ¼Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² ÑĞºÑ– Ğ±ÑƒĞ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ– Ğ·Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ– 2 Ñ‚Ğ¸Ğ¶Ğ½Ñ–
    two_weeks_ago = DateTime.utc_now() |> DateTime.add(-14, :day)

    Feedbacks.filter_feedbacks(%{from: two_weeks_ago})
    |> Enum.map(& &1.telegram_user_id)
    |> Enum.uniq()
    |> Enum.reject(&is_nil/1)
  end
end
